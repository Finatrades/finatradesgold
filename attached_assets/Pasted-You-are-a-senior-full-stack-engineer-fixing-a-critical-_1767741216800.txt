You are a senior full-stack engineer fixing a critical BNSL plan mismatch bug in a gold-backed platform.

BUG SUMMARY
In BNSL, user selects “12 months locked plan @ 10.00% p.a.” at the plan selection step, but after activation / viewing the plan, the created plan displays “12 Months @ 8% p.a.” This is a trust-breaking issue.

GOAL
Ensure the APR shown at selection is EXACTLY the APR stored in DB for that plan instance, and the plan details page reads from the stored value (not a hardcoded/default mapping). Add validations and regression tests.

TASKS

1) TRACE THE FLOW (END-TO-END)
- Find the BNSL plan selection UI component (where 12/24/36 months and APR is shown).
- Identify how plan is created:
  - Which API is called on “Start Plan/Confirm” (POST /bnsl/activate or similar)?
  - What payload fields are sent (duration, apr, planId, productCode, etc.)?
- Find the backend service that creates the plan record.
- Find the “My Plans” / “View Plan” UI endpoint and confirm where the APR is sourced.

2) IDENTIFY ROOT CAUSE (COMMON CAUSES TO CHECK)
Check each possibility and fix the correct one:
A) Frontend sends only duration (12) and backend applies a default APR (8%).
B) Frontend sends apr=10 but backend ignores it, overwrites with config/default.
C) Backend uses wrong mapping table for duration → APR (old config says 12m=8%).
D) “Display APR” uses hardcoded UI label (e.g., if duration==12 show 8%) instead of reading DB.
E) There are multiple plan types (locked vs flexible) and the wrong plan type is being saved or displayed.
F) A caching issue or stale config is being used in view endpoint.

3) SINGLE SOURCE OF TRUTH DESIGN (IMPLEMENT)
Make APR come from ONE authoritative source (recommended order):
- Product Config Table (bnsl_products / bnsl_plan_templates) defines official APR for (duration, planType, currency/metal).
- When user activates a plan, store the APR snapshot into the plan instance table:
  bnsl_plans.apr_applied (decimal) AND bnsl_plans.template_id
- My Plans / Plan Details must display bnsl_plans.apr_applied (not recalculated).

Rules:
- Never trust client-submitted APR for locked plans (security). Backend must compute APR based on template_id/duration/planType and store snapshot.
- Client may send template_id (or planCode). Backend validates it and fetches APR from DB/config.

4) BACKEND FIX
- Update create/activate plan endpoint:
  Input should include: duration_months, plan_type, template_id (or plan_code)
  Backend steps:
   a) Load template by template_id
   b) Validate template.duration == requested duration and template.active == true
   c) Set apr_applied = template.apr
   d) Save plan with duration_months + apr_applied + template_id
- Update fetch endpoints:
  GET /bnsl/plans (list) and GET /bnsl/plans/:id must return apr_applied explicitly.

5) FRONTEND FIX
- In selection UI: it’s OK to show template.apr for preview.
- When confirming start plan: send template_id (or plan_code) NOT apr.
- In “My Plans” list and “Plan Card”:
  display apr_applied from API response.
- Remove any duration→APR hardcoded mapping in UI.

6) DATA MIGRATION / HOTFIX (IF EXISTING PLANS WRONG)
- Add a script/migration:
  For active plans where template_id exists OR duration_months known:
   - If apr_applied != template.apr, decide:
     a) If plan was created with wrong APR due to bug, update apr_applied to template.apr AND recalculate payout schedule totals.
     b) If plan must preserve original contract terms, keep apr_applied but fix display to match stored.
- Choose the safer contractual approach:
  If users saw 10% at activation time, they expect 10%. Prefer correcting stored apr_applied to 10% if evidence shows selection was 10%.
  Add audit log entry for any backfilled changes.

7) TESTS (REQUIRED)
Add regression tests:
- Create 12m locked plan using template 12m@10%:
  response.apr_applied == 10
- “My Plans” returns the same apr_applied
- UI renders “12 Months @ 10% p.a.”
- Ensure 24m and 36m also match their templates
- Negative tests:
  - invalid template_id → 400
  - template duration mismatch → 400
  - inactive template → 400

8) OUTPUT REQUIRED
When done, provide:
- Root cause found (exact file/function)
- Files changed
- Updated request/response JSON examples
- Any migration/backfill steps run
- How to verify manually in UI

Now implement the fix in code with clean structure, no breaking changes, and ensure gold-backed platform terminology remains consistent.
