You are a senior product/ledger architect and backend engineer.

Goal:
Build a CENTRALIZED “Statement Engine” for Finatrades that generates one unified account statement for any user by classifying EVERY wallet/ledger event into:
1) CREDIT entries (money/gold coming IN)
2) DEBIT entries (money/gold going OUT)
3) HOLDING / LOCKED entries (funds reserved/locked but not spent)

Do NOT change our existing business logic.
Do NOT change existing tables unless necessary.
Instead, create a statement layer that reads from current sources (transactions, ledger, wallets, certificates, trade cases, bnsl locks) and produces a consistent statement view.

STATEMENT CLASSIFICATION RULES (must match our platform logic)

A) CREDIT entries (IN)
- Add Funds / Deposit into FinaPay:
  - Card deposit
  - Bank transfer deposit
  - Crypto deposit
- Request Payment received (incoming transfer)
- Buy Gold (if modeled as credit of gold grams into wallet)
- Deposit Gold into Vault (physical deposit credited to ownership balance)

B) DEBIT entries (OUT)
- Send Payment (outgoing transfer)
- Sell Gold (grams leave vault/ownership; USD credited for cashout flow)
- Cashout / Withdrawal (USD leaves system)
- Request Payment paid (outgoing request settlement)

C) HOLDING / LOCKED entries (RESERVED)
- FinaBridge locked settlement (reserved grams/USD for trade case)
- BNSL locked gold (locked grams/USD for plan)
- Any other “reserved / on-hold / pending settlement” amounts

OUTPUT FORMAT (the unified statement row)
Return statement rows with:
- statementId (stable id)
- userId
- timestamp
- category: CREDIT | DEBIT | HOLD
- subtype (e.g., CARD_DEPOSIT, BANK_DEPOSIT, CRYPTO_DEPOSIT, TRANSFER_IN, TRANSFER_OUT, BUY_GOLD, SELL_GOLD, CASHOUT, VAULT_DEPOSIT, FINABRIDGE_LOCK, BNSL_LOCK)
- direction: IN | OUT | LOCK | UNLOCK
- amountUsd (nullable if not applicable)
- amountGoldGrams (nullable if not applicable)
- referenceId (txId / depositId / transferId / tradeCaseId / bnslPlanId / certificateId)
- status (PENDING | CONFIRMED | FAILED | CANCELED)
- description (human readable)
- counterparty (masked email or walletId for transfers)
- balances snapshot (optional): finapayUsd, goldGramsAvailable, goldGramsLocked
- metadataJson (method, rail, network, fees, notes)

IMPORTANT:
- Support both USD and grams. If a row has both, keep both.
- Never use floats for money or grams; use decimal-safe type.
- Always include status and reference id.

STATEMENT DATA SOURCES (ADAPT TO EXISTING CODEBASE)
First, scan current tables/services and map:
- deposits (card/bank/crypto) -> credit
- transfers/payments -> credit/debit based on sender/receiver
- gold buy/sell -> credit/debit
- withdrawals/cashout -> debit
- vault deposit requests -> credit (ownership increase)
- bnsl locks -> HOLD (LOCK) and unlock/maturity -> HOLD (UNLOCK)
- finabridge settlements -> HOLD (LOCK) and release -> HOLD (UNLOCK)
- certificates are attachments (do not duplicate as entries) but link certificateId where relevant.

ENGINE REQUIREMENTS
1) Create a Statement Builder service:
- buildStatement(userId, filters) => rows[]
Filters:
- date range
- category
- subtype
- status
- min/max amount

2) Create endpoints:
- GET /api/statement?from=&to=&category=&status=
- GET /api/admin/users/:id/statement (admin view)
- GET /api/statement/export.csv (optional)

3) Consistency & correctness:
- Ensure every financial event results in exactly one statement entry per user per side.
- For transfers, generate:
  - DEBIT for sender
  - CREDIT for receiver
- For locks:
  - HOLD LOCK entry when funds reserved
  - HOLD UNLOCK entry when released
- If an event reverses/refunds, create reversal entries (do not delete history).

4) UI (User Side)
Create “Statements” page:
- Tabs: All | Credits | Debits | Holding
- Filters: date range, type, status
- Row click => details drawer:
  - show reference data + linked certificates if available
- Export CSV/PDF button

5) Admin Side
User 360 -> add “Statement” tab:
- same view + internal ids + audit trail link

6) Logging & Audit
- Log statement generation queries (requestId, userId, filters)
- Do not log PII; mask emails.

DELIVERABLE
- A clear mapping table in code:
  Each event type -> statement category/subtype
- Implement the statement builder using current data sources
- Add tests:
  - Deposit shows CREDIT
  - Transfer shows DEBIT for sender and CREDIT for receiver
  - BNSL lock shows HOLD LOCK and unlock shows HOLD UNLOCK
  - FinaBridge lock shows HOLD LOCK and release shows HOLD UNLOCK
  - Sell gold shows DEBIT grams, cashout shows DEBIT USD

Start now:
1) Scan the repo and list existing transaction/deposit/lock tables and statuses.
2) Implement the mapping function.
3) Build the statement endpoint and sample response.
4) Build the UI page with filters and details drawer.
