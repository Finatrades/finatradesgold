You are a senior full-stack engineer + QA automation lead.

Project: Finatrades dashboard (Replit app)
Goal: Build a REAL end-to-end “Deposit Funding Test Runner” that:
- Asks me for METHOD + AMOUNT first
- Asks APPROVAL second
- Runs the deposit flow (sandbox/QA safe)
- Generates certificates (Ownership + Storage + Invoice) after confirmation
- Sends notification emails (in QA/sandbox mode) and logs everything
- Updates UI instantly (no refresh)

TEST USER:
Email: leagal@finatrades.com

TEST CASES:
1) BANK: $1,000
2) CRYPTO: $3,000
3) CARD: $5,000

SAFETY / COMPLIANCE (non-negotiable):
- NEVER request/store card numbers, CVV, OTP, bank credentials, seed phrase, private keys.
- Use provider sandbox mode only, or DRY_RUN if production.
- Emails must be safe: no secrets, no tokens, no payment credentials.
- If SMTP not configured, store emails in an “Outbox” table and show them in UI.

WHAT TO BUILD:

1) QA Test Runner Page
Route: /qa/deposit-test
Access: only if QA_MODE=true OR admin role
Wizard Steps:
Step 1) Select Method: BANK | CRYPTO | CARD
Step 2) Enter Amount (USD)
Step 3) Confirm Summary (show min/max pulled from config)
Step 4) Approval: Approve / Reject
Step 5) Execute + Live Status + Report

2) Single Source of Truth for Limits
Config file: /src/config/limits.ts
Env variables:
- BANK_DEPOSIT_MIN_USD / BANK_DEPOSIT_MAX_USD
- CRYPTO_DEPOSIT_MIN_USD / CRYPTO_DEPOSIT_MAX_USD
- CARD_DEPOSIT_MIN_USD / CARD_DEPOSIT_MAX_USD
Frontend helper text and backend validation MUST read from same config.
Return structured errors:
{ code:"LIMIT_MIN", message:"Minimum deposit amount is $X", meta:{min:X} }

3) Unified QA Run API
POST /api/qa/deposit/run
Body: { email, method, amountUsd, approve:boolean }
Behavior:
- Always create a requestId (uuid)
- If approve=false => status=DECLINED, log only
- If approve=true:
   - Create a deposit attempt + transaction record
   - In QA_MODE=true: auto-confirm after 2 seconds (simulate provider confirmation)
   - In non-QA: keep as PENDING unless provider callback confirms

4) Certificate Generation (after CONFIRMED only)
When deposit becomes CONFIRMED, auto-generate PDFs:
A) Digital Ownership Certificate (issued by Finatrades)
B) Storage Certificate (issued by Wingold & Metals DMCC) - can be “Partner Issued / System Generated (QA)”
C) Invoice (Wingold & Metals DMCC)
Store as files or blobs:
- /storage/certificates/{transactionId}/ownership.pdf
- /storage/certificates/{transactionId}/storage.pdf
- /storage/certificates/{transactionId}/invoice.pdf
Create DB records:
certificates table: { id, transactionId, type, url/path, hash, issuedAt, issuerName }

Certificate fields must include:
- Full name (from user profile)
- Wallet ID
- Transaction ID
- Amount USD
- Gold grams equivalent (computed)
- Purity 99.99% (if your platform uses that)
- Date/time
- Vault operator: FinaVault
- Vault facilitator: Wingold & Metals DMCC
- Disclaimer: “QA/Sandbox document — not for real settlement” when QA_MODE=true

5) Email Notifications (after CONFIRMED only)
Send email to: leagal@finatrades.com
Email templates (HTML + text):
- Subject: “Deposit Confirmed — $X via METHOD”
Body includes:
- Amount + method + transaction ID
- Gold grams equivalent
- Links to download certificates (ownership/storage/invoice)
- Support footer
Do NOT attach secrets.
If SMTP is missing:
- Save email into DB outbox_emails table with status=QUEUED
- Display in QA Test Runner UI with “View Email” button

6) Real-time UI Updates (no refresh)
Implement SSE or WebSocket:
- Stream transaction status updates + new certificates + new email outbox status
When confirmed, dashboard updates:
- balance tiles
- transaction list
- certificates list

7) Full Logging + Test Report
Structured JSON logs everywhere:
{ ts, level, requestId, email, method, amountUsd, event, details }
Log events:
- VALIDATION_PASS/FAIL
- APPROVAL_ACCEPTED/DECLINED
- TX_CREATED
- STATUS_PENDING
- STATUS_CONFIRMED
- CERTS_GENERATED (with paths + hashes)
- EMAIL_QUEUED / EMAIL_SENT
QA UI must show:
- Final status
- Tx ID
- Updated balances
- Certificate links
- Email preview/link
- Download logs button (.json)

8) One-click test buttons (still require approval)
Buttons:
- Run Bank $1000
- Run Crypto $3000
- Run Card $5000
Each pre-fills method+amount but MUST still ask “Approve now?”

After implementation:
- Run the 3 tests for leagal@finatrades.com in QA_MODE=true
- Show the reports and confirm certificates generated + email queued/sent + UI updated instantly.
