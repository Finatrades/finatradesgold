You are a senior QA automation engineer + security-minded full-stack developer.

Project: Finatrades (Replit)
Goal: Create a COMPLETE automated test system for TESTING ACCOUNTS and EMPLOYEE (admin/ops/compliance) flows.
The system must test ALL scenarios end-to-end and produce clear SYSTEM LOGS + ERROR LOGS like production.

NON-NEGOTIABLE:
- Use QA_MODE=true (sandbox only). No real payments, no real bank/crypto, no real card details.
- Never request/store OTP, card number, seed phrase, private keys.
- Every test must output structured JSON logs with requestId and actor (user/admin).

TEST ACCOUNTS (create if missing):
Users:
- user1@test.finatrades.com (KYC: NOT_SUBMITTED)
- user2@test.finatrades.com (KYC: PENDING)
- user3@test.finatrades.com (KYC: APPROVED)
Employees:
- ops@test.finatrades.com (Role: OPS)
- compliance@test.finatrades.com (Role: COMPLIANCE)
- admin@test.finatrades.com (Role: ADMIN)

WHAT TO BUILD:

1) QA Test Harness
- Add route: /qa/tests
- Access: ADMIN only or QA_MODE=true
- Buttons:
  - Run Smoke Tests
  - Run Full Regression
  - Run Role/Permission Tests
  - Run KYC Gate Tests
  - Run Deposit/Transfer/Certificates Tests (sandbox)
  - Export Logs (.json)

2) Logging System (must be visible)
Create centralized logger used by frontend + backend:
Log format:
{ ts, level, requestId, suite, testName, actorEmail, actorRole, route, event, details, errorStack? }
- Save logs to:
  a) console
  b) /logs/qa-YYYYMMDD.json
  c) DB table qa_logs (optional)
- UI panel shows last 200 logs with filters (level/testName/actor)

3) Test Framework
Use:
- Unit tests: Vitest/Jest
- API integration: Supertest (or equivalent)
- E2E UI: Playwright (headless for Replit)
Add scripts:
- "test:unit"
- "test:api"
- "test:e2e"
- "test:all" (unit + api + e2e)
- "qa:full" (seeds + test:all + export report)

4) Seed & Reset
Create a safe reset script:
- seeds test users and employees
- resets wallets/transactions/certificates in QA environment
- does NOT affect production data
Command: npm run qa:seed

5) REQUIRED SCENARIOS (must be automated)

A) Auth / Account
- Sign up -> email verification simulated -> sign in -> sign out
- Invalid password -> error shown + logged
- Session refresh works (auto update, no manual refresh)

B) Role & Permissions (employees)
- OPS can view deposits/withdrawals but cannot approve compliance
- COMPLIANCE can approve/reject KYC and view audit logs
- ADMIN can manage roles, see all modules, access QA tools
- Unauthorized access to /admin routes returns 403 and is logged

C) KYC Gate (core platform rule)
- If KYC not approved, user cannot:
  - deposit
  - withdraw
  - transfer
  - create BNSL plan
  - open FinaBridge case
Test all these blocks with correct UI error + API error code (KYC_REQUIRED)

D) Deposit Flow (sandbox)
Test for each rail with limits coming from config:
- BANK $1000 -> PENDING -> CONFIRMED (auto in QA) -> ledger updated -> certificate generated -> email queued
- CRYPTO $3000 -> same
- CARD $5000 -> same
Also test:
- Below min -> LIMIT_MIN
- Above max -> LIMIT_MAX
- Non numeric -> VALIDATION_ERROR
Ensure UI helper text min/max matches backend rules (no mismatch like $10 vs $50)

E) Transfer Flow (sandbox ledger)
- Approved KYC user transfers $2000 equivalent to another approved user
- Balances update instantly
- Transaction appears in both accounts
- Ownership/certificate counts update properly

F) Certificates & Emails
- After CONFIRMED deposit, generate:
  - Digital Ownership Certificate (Finatrades)
  - Storage Certificate (Wingold & Metals) marked QA if QA_MODE
  - Invoice
- Emails:
  - Deposit confirmed email includes links to certificates
  - If SMTP missing, store in Outbox and show in UI
Verify:
- certificate records exist
- download endpoints return 200
- hashes stored
- audit log entries created

G) Employee Workflows (approval scenarios)
- COMPLIANCE reviews KYC PENDING -> APPROVE -> user instantly gets access
- COMPLIANCE rejects KYC -> user remains blocked
- OPS reviews deposit requests list, changes status to “Reviewed”
- ADMIN views User 360 and audit trail for all actions

H) Audit & Security Checks
- Every sensitive action must create an audit log row:
  { actor, action, target, before, after, ts }
- Test tamper resistance basics:
  - API rejects missing auth
  - API rejects role violations
  - Rate limit (basic) for login attempts in QA
- Log errors with stack traces server-side but show user-friendly messages in UI

6) Test Report Output
After every run generate:
- /reports/qa-report.html
- /reports/qa-report.json
Include:
- pass/fail summary
- screenshots (Playwright) on failures
- key logs and requestIds for debugging

IMPLEMENTATION STEPS:
- First scan codebase for auth, roles, KYC checks, deposits, certificates.
- Add QA_MODE config and seed scripts.
- Add logger.
- Add tests suite by suite.
- Ensure tests are deterministic and run in <5 minutes on Replit.

Finally:
- Run `npm run qa:full`
- Print the final summary with failed tests (if any) and exact file locations to fix.
